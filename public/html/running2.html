<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrida 360</title>
    <link rel="stylesheet" type="text/css" href="../styles/video.css">
    <link rel="stylesheet" type="text/css" href="../styles/mediapipe.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.1/control_utils.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.1/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.1/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.1/holistic.js" crossorigin="anonymous"></script> 
  
    
</head>
<body>
    <div style="position: absolute; width: 100%; height: 100%" >
        <iframe id="video" width="100%" height="100%" src="https://www.youtube.com/embed/0Mm9yfGRfzw?enablejsapi=1&html5=1&controls=0&showinfo=0&autoplay=1&rel=0" 
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <p id="overlayDesktop" style="z-index: 0; text-align: center; font-size: 20px;">
            Gire a tela para uma melhor experiência
        </p>
        <audio id="music">
            <source src="../musics/R.E.M. - Losing My Religion Lyrics.mp3" type="audio/mpeg">
        </audio>
        
        <section class="rectangle"> 
            <a href="running.html"> <button id="overlayDesktop" style="z-index: 0; text-align: center;"> <img class="icons" src="../icons/return.svg" title="RETORNAR"></button></a>
            <a href="running.html"> <button class="overlayMobile"> <img class="icons" src="../icons/return.svg" title="RETORNAR"></button></a>
            <button id="play-button" class="overlayMobile"><img class="icons" src="../icons/play.svg" title="REPRODUZIR"></button>
            <button id="pause-button" class="overlayMobile"><img class="icons" src="../icons/pause.svg" title="PAUSAR"></button>
            <button id="stop-button" class="overlayMobile"><img class="icons" src="../icons/restart.svg" title="REINICIAR"></button>
            <button onclick="getPlayVelocity()" type="button" class="overlayMobile"><img class="icons" src="../icons/velocity.svg" title="VELOCIDADE"></button>
            <input id="speed-button" class="overlayMobile" value="Speed" type="button" title="VELOCIDADE EM TEMPO REAL"/>
            <button onclick="setPlaySlow()" type="button" class="overlayMobile"><img class="icons" src="../icons/turtle.svg" title="LENTO"></button>
            <button onclick="setPlayFast()" type="button" class="overlayMobile"><img class="icons" src="../icons/fast.svg" title="RÁPIDO"></button>
            <button onclick="audioPlay()" class="overlayMobile"><img class="icons" src="../icons/music.svg" title="MÚSICA"></button>
            <a href="running3.html"><button class="overlayMobile"><img class="icons" src="../icons/next.svg" title="PRÓXIMO VÍDEO"></button></a>
            <!--<button class= "buttons" onclick="setPlayNormal()" type="button">1.0x</button><br> -->
            <progress id="progress" max="100" value="0">Progress</progress>
        </section>

        <script>
            //Injetar script da API do YouTube
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/player_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            //Variável global
            var player;
            //Essa função é chamada quando a API está pronta para uso
            function onYouTubePlayerAPIReady() {
                //crie o player global a partir do iframe específico (#video)
                player = new YT.Player('video', {
                    events: {
                        //Chame esta função quando o player estiver pronto para usar
                        'onReady': onPlayerReady
                    }
                });
                progressBar();
            }
            function onPlayerReady(event) {
                var playButton = document.getElementById("play-button");
                playButton.addEventListener("click", function() {
                    player.playVideo();
                });
                var pauseButton = document.getElementById("pause-button");
                pauseButton.addEventListener("click", function() {
                    player.pauseVideo();
                });
                var stopButton = document.getElementById("stop-button");
                stopButton.addEventListener("click", function() {
                    player.stopVideo();
                });
            }
            function getPlayVelocity() {   
                alert("Sua velocidade é " + player.getPlaybackRate());
                console.log(player.getPlaybackRate()); 
            } 
            function setPlaySlow() { 
                let playRate = player.getPlaybackRate() > 0.5? player.getPlaybackRate()/2:  0.5; 
                player.setPlaybackRate(playRate);
            } 
            function setPlayFast(){
                let playRate =  player.getPlaybackRate()+0.5; 
                player.setPlaybackRate(playRate);
            }
            function setPlayNormal(){
                let playRate = 1.0;
                player.setPlaybackRate(playRate);
            }
            var musicAudio = document.getElementById("music");
            var audioPlay = function() {
                if (musicAudio.duration > 0 && !musicAudio.paused) {
                    musicAudio.pause();
                    innerHTML = "Pause";
                } else {
                    musicAudio.play();
                    innerHTML  = "Play";
                }
            }
            function nameChoose() {
                document.getElementById("speed-button").value = new Intl.NumberFormat('pt-IN', { maximumSignificantDigits: 2 }).format(localStorage.getItem("desvioPadrao")*1000);
            }
            setInterval(nameChoose, 250);

            var progress = document.getElementById("progress");

            function progressBar() {
                setInterval(function () {
                    progress.value = Math.round((player.getCurrentTime() / player.getDuration()) * 100);
                });
            }
        </script>
    

    <div class="container">
        <video class="input_video"></video>
        <canvas class="output_canvas" width="256px" height="144px"></canvas>
        <div class="loading">
          <div class="spinner"></div>
          <div class="message">
            Loading
          </div>
        </div>
        <a class="abs logo" href="http://www.mediapipe.dev" target="_blank">
          <div style="display: flex;align-items: center;bottom: 0;right: 10px;">
            <span class="title">MediaPipe</span>
          </div>
        </a>
      </div>
      <div class="control-panel">
      </div>
      <script src="mediapipe.js" ></script>
    </div>
</body>
</html>